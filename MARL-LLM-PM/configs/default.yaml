# MARL-LLM-PM Experiment Configuration
# All design decisions documented here are frozen before held-out evaluation.

# ---------------------------------------------------------------------------
# Data
# ---------------------------------------------------------------------------
data:
  # Equity strategy return series (one column per strategy)
  # Can be synthetic (mode: synthetic) or loaded from file (mode: csv)
  mode: synthetic          # synthetic | csv
  csv_path: null           # path to CSV with columns: date, momentum, value, quality
  strategies: [momentum, value, quality]
  start_date: null         # null = infer from data
  end_date: null

# ---------------------------------------------------------------------------
# Environment (PortfolioStrategyEnv)
# ---------------------------------------------------------------------------
environment:
  initial_cash: 1_000_000
  transaction_cost: 0.001    # 10 bps per unit of L1 turnover
  lookback_window: 60        # trading days of history in observation
  risk_aversion: 1.0         # penalty weight on realised volatility in reward

# ---------------------------------------------------------------------------
# Constraint wrapper (Layer 4)
# ---------------------------------------------------------------------------
constraints:
  enabled: true              # set false for "baseline" and "llm_only" ablations
  mechanism: projection      # projection | penalty
  max_weight: 0.70           # concentration cap per strategy (e.g. w_i <= 0.70)
  min_weight: 0.0            # non-negativity (0 = no lower bound beyond 0)
  penalty_coeff: 5.0         # used only when mechanism: penalty

# ---------------------------------------------------------------------------
# LLM Regime Interpreter (Layer 3)
# ---------------------------------------------------------------------------
llm:
  enabled: true              # set false for "baseline" and "constrained" ablations
  model: claude-opus-4-6
  max_tokens: 256
  temperature: 0.1           # low temperature for consistency
  # Regime vocabulary is FIXED — do not modify without updating regime_interpreter.py
  regime_vocab:
    - TRENDING-LOWVOL
    - STRESS-DRAWDOWN
    - RECOVERY
    - SIDEWAYS-HIGHCORR
    - RISK-OFF-DEFENSIVE
  # How often to query LLM (every N trading days)
  # Set to 1 for daily; 5 for weekly; 21 for monthly
  update_frequency_days: 21  # monthly to minimise API cost during development

# ---------------------------------------------------------------------------
# Strategy agents
# ---------------------------------------------------------------------------
agents:
  mode: signal_softmax       # signal_softmax (Phase 1) | learned (Phase 2 PPO)
  # PPO hyperparameters (Phase 2 — leave defaults for Phase 1)
  algorithm: PPO
  learning_rate: 3.0e-4
  gamma: 0.99
  n_steps: 2048
  batch_size: 64
  n_epochs: 10
  policy: MlpPolicy

# Meta-allocator
meta_allocator:
  mode: signal_softmax       # signal_softmax | learned
  checkpoint_dir: checkpoints/meta_allocator

# ---------------------------------------------------------------------------
# Training
# ---------------------------------------------------------------------------
training:
  total_timesteps: 500_000
  eval_freq: 10_000
  checkpoint_freq: 50_000
  log_dir: logs/

# ---------------------------------------------------------------------------
# Walk-forward evaluation protocol
# ---------------------------------------------------------------------------
walk_forward:
  train_frac: 0.60
  val_frac: 0.20
  # test = remaining 0.20, split into non-overlapping windows
  test_window_months: 6
  held_out_months: 12        # last 12 months are SEALED

# ---------------------------------------------------------------------------
# Ablation modes
# ---------------------------------------------------------------------------
# Defines which combination of LLM and constraints to use.
# The Backtester reads these flags at runtime.
# "full" = proposed system; others = ablation baselines.
#   baseline:    llm=off, constraints=off
#   constrained: llm=off, constraints=on
#   llm_only:    llm=on,  constraints=off
#   full:        llm=on,  constraints=on
ablation:
  default_mode: full

# ---------------------------------------------------------------------------
# Evaluation and reporting
# ---------------------------------------------------------------------------
evaluation:
  metrics:
    - annual_return
    - volatility
    - sharpe_ratio
    - sortino_ratio
    - max_drawdown
    - calmar_ratio
    - avg_turnover
  attribution:
    enabled: true
    dominance_threshold: 0.50   # fraction for attribution consistency (thesis spec)
    background_n: 50            # SHAP kernel explainer background samples
  regime_responsiveness: true
